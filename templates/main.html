{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>image captioning generator｜ image caption generator,subtitle,subtitle from image,make subtitle </title>
    <meta name="description" content="Users upload pictures, AI analyzes the picture content, and generates image captions">
    <meta name="keywords" content="image captioning generator,image captioning,image caption,caption generator,Add caption to an Image or Photo,">
     
    {% block ext_css %}
    <link rel="stylesheet" href={% static 'css/main/main.css' %} />
    <link href={% static 'css/bootstrap.min.css' %} rel="stylesheet">
    {% endblock %}
<style>
    .error{
    color: red;
    display: flex;
    margin-top: 5px;
    margin-bottom: 5px;
    font-size: 14px; /* 设置字体大小为14px */
}
    html, body {
            height: 100%;
            margin: 0;
        }
</style>

</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HV4ZH0DEWW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HV4ZH0DEWW');
</script>


<body>
<div class="container">
<div style="flex:1;">
    {% block content %}
    <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between sticky-top" style="background-color: white">
        <a href="{%  url 'index' %}" class="d-flex align-items-center col-md-3 mb-2 mb-md-0 text-dark text-decoration-none">
            <img src={% static 'img/logo-dark.png' %} alt="logo" height="80px" class="d-inline-block align-top">
        </a>
             
        <div class="dropdown">
            <div onclick="checkicon()" id="dropdownMenuButton"  class="dropdown-toggle-split" data-bs-toggle="dropdown" 
                    style="border: none;background-color: white;" >
                <div id="userDiv" class="userinfo" style="height: 50px;display: flex">
                    <div class="circle-image" style="width: 40px;height: 40px;margin-top: 5px;">
                        <img src="{% static 'img/touxiang.png' %}" style="width: 100%" alt="圆形图片">
                    </div>
                    <p id="userTitle" class="text" style="font-size: 16px;line-height: 42px;margin-left: 10px;margin-top: 8px;"></p>
                    <div class="circle-image" style="width: 20px;height: 20px;margin-left: 20px;margin-top: 15px">
                        <img id="upanddonwicon" src="{% static 'img/icon/up.svg' %}" style="width: 100%;height: 100%">
                    </div>
                </div>
            </div>
            <div class="dropdown-menu" id="customList">
                <a class="dropdown-item disabled" style="height: 40px;">
                    Number of images：<span id="resourceSpan">{{ user_resource }}</span>
                </a>
                    <a class="dropdown-item" href="{% url 'login_out' %}" onclick="checkicon()" style="color: #0a53be;height: 40px;">LOGOUT</a>
            </div>
        </div>
    </header>
    {% endblock %}

    <div class="container pt-5" style="background-color: #3e4ac6;height: 200px">
        <h1 class="text-center">image captioning generator</h1>
        <p class="text-p">When you upload a photo, AI will generate appropriate emotional captions based on the content of the photo,<br> as well as titles and content for sharing, making it easier to spread through social media.</p>
    </div>
     <div class="row" style="margin-top: 20px;">
         <div class="col-6">
             <form class="row" enctype="multipart/form-data" id="subtitleForm">
                <div calss="col-md-6">
                    <h2 style="margin-top:30px">Select image to upload</h2>
                    <div class="mb-3">
                        <input type="file" id="file-input" accept=".jpg, .jpeg, .png" class="form-control">
                        <label for="imageFile" class="form-label" style="margin-top: 10px">Support jpg, png, jpeg formats</label>
                    </div>
                    <div class="mb-3" id="previewBox" style="display:none;" >
                        {% if image_url %}
                            <img id="previewImage" src="{{ image_url }}" alt="Image Preview" class="img-thumbnail">
                        {% else %}
                            <img id="previewImage">
                        {% endif %}
                    </div>
                </div>
                 <span class="error" id="errorText"></span>
                {% csrf_token %}
                <button id="loadingButton" class="btn btn-primary" disabled style="width: 80%;margin-top:30px;display: none">
                    <span class="spinner-border spinner-border-sm"></span>
                    Loading...
                </button>
                <button type="submit" disabled class="btn btn-primary" id="generateBtn" style="width: 80%;margin-top:30px" class="submit">Generate subtitles</button>
            </form>
         </div>
         <div class="col-6" style="display: none;" id="resource_box">
             <div style="width: 95%;margin-left: 2.5%">
                <p id="showTitle" style="font-size: 30px;"></p>
                <p id="showDetail" style="font-size: 20px;"></p>
             </div>
             <div>
                <img id="get_make_subtitle" style="width: 80%;margin-left: 10%" alt="Image Preview" class="img-thumbnail">
                 <button id="down_loading_button" class="btn btn-primary" disabled style="margin-top:20px;width: 80%;margin-bottom: 10px;margin-left: 10%;display: none">
                    <span class="spinner-border spinner-border-sm"></span>
                    Loading...
                </button>
                <button type="submit" class="btn btn-primary" id="downBtn" style="margin-top:20px;width: 80%;margin-bottom: 10px;margin-left: 10%" class="submit">Download photos without watermark</button>
             </div>
         </div>
    </div>
   
</div>
</div>
<div style="background-color: #1a1d20;height: 300px;margin-top: auto;">
        <div style="display:flex;width: 1440px;margin: 0 auto;">
            <img src="{% static 'img/logo-dark.png' %}" style="height: 150px;margin-left: 80px;margin-top: 80px">
            <div style="margin-top: 120px;margin-left: 200px">
               <H1 style="color: white">How to contact the author</H1>
                <p style="color: white">email: shifengwei88@126.com</p>
            </div>
        </div>
</div>


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>

<script>
    
    
    // 点击空白处关闭下拉菜单，同时执行其他事件
    document.addEventListener('click', function(event) {
        var target = $(event.target);
        var dropdownMenu = $('.dropdown-menu');
        var dropdownButton = $('#dropdownMenuButton');
        var image = document.getElementById('upanddonwicon');
        // 检查点击是否发生在下拉菜单或下拉按钮之外
        if (!target.closest(dropdownButton).length) {
            dropdownMenu.removeClass('show');
            image.src= "{% static 'img/icon/up.svg' %}";
        }else{
            dropdownMenu.addClass('show')
             image.src= "{% static 'img/icon/down.svg' %}";
        }
    });

        
    document.addEventListener('DOMContentLoaded', function() {
        
        var resourceSpan = document.getElementById('resourceSpan')
        var user_resource = {{ user_resource | default:0 }}
        
        if (user_resource < 10) {
            resourceSpan.style.color = "red";
        }else {
             resourceSpan.style.color = "#3e4ac6";
        }
        
            var sessionAge = {{ session_cookie_age |default:"3600" }};
            console.log('Session age:', sessionAge);
            
           // 假设 login_time 是从模板中传递过来的
            var loginTimeStr = "{{ request.session.login_time }}";
            
            // 解析 ISO 8601 格式的时间字符串
            var loginTime = new Date(loginTimeStr);
            console.log("Login time: ", loginTime);

            // 例如，计算登录时间与当前时间的差异
            var now = new Date();
            var timeDifference = now - loginTime;  // 时间差异以毫秒为单位
 
            // 检查是否超过会话过期时间
            if (timeDifference/1000 > sessionAge) {
                userDiv.style.display = 'none';
                window.location.href = "{% url 'login_out' %}"; 
                return;
            }
            
            // 定时检查（例如每分钟检查一次）
            setInterval(function() {
                var currentTime = Math.floor(Date.now() / 1000);
                var elapsedTime = currentTime - loginTime;
                if (elapsedTime/1000 > sessionAge) {
                    userDiv.style.display = 'none';
                    window.location.href = "{% url 'login_out' %}";
                    return;
                }
            }, 60000); // 每60秒检查一次
    });
    
    function checkicon(){
        var list = document.getElementById('customList');
        var image = document.getElementById('upanddonwicon');
            if (list.classList.contains('show')) {
                list.classList.add('show');
                image.src= "{% static 'img/icon/down.svg' %}"
            } else {
                list.classList.remove('show');
                image.src= "{% static 'img/icon/up.svg' %}"
            }
    }
    
    
</script>

{% block ext_js %}
    <script src={% static 'js/bootstrap.bundle.min.js' %}></script>
    <script src={% static 'js/main.js' %}></script>
{% endblock %}

</body>
</html>


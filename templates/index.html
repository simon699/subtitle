{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>image captioning generator｜ image caption generator,subtitle,subtitle from image,make subtitle </title>
    <meta name="description" content="Users upload pictures, AI analyzes the picture content, and generates image captions">
    <meta name="keywords" content="image captioning generator,image captioning,image caption,caption generator,Add caption to an Image or Photo,">

    <link rel="shortcut icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">

    {% block ext_css %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/index/index.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">
        <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    {% endblock %}
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HV4ZH0DEWW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HV4ZH0DEWW');
</script>

<body >
{% block content %}
    <div class="container">
        <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between sticky-top">
            <a href="#" class="d-flex align-items-center col-md-3 mb-2 mb-md-0 text-dark text-decoration-none">
                <img src="{% static 'img/logo-dark.png' %}" alt="logo" height="80px" class="d-inline-block align-top">
            </a>
            
            <div id="buttonDiv">
                <button type="button" class="btn btn-outline-primary me-3" onclick="location.href = '{% url 'login' %}'">LOGIN </button>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" onclick="location.href = '{% url 'signup' %}'">SIGN UP</button>
            </div>
             <div id="userDiv" class="userinfo" style="height: 50px" onclick="redirectToMainView()">
                    <div class="circle-image" style="width: 40px;height: 40px;margin-top: 5px;">
                        <img src="{% static 'img/touxiang.png' %}" style="width: 100%" alt="圆形图片">
                    </div>
                    <p id="userTitle" class="text" style="font-size: 16px;line-height: 42px;margin-left: 10px;margin-top: 8px;"></p>
             </div>
        </header>

    </div>
    <div class="carousel slide" data-bs-ride="carousel" style="width: 100%;margin: 0 auto;background-color: #3e4ac6;">
        <div class="carousel-inner"  style="width: 1440px;margin: 0 auto;display: flex">
            <div>
                <h2 class="carouse-h2" data-wow-delay="0.2s" style="text-align: left;margin-left: 100px;">Add captions to photos <br> to add emotional records</h2>
                <p class="carouse-p" data-wow-delay="0.4s" style="text-align: left;margin-left: 100px;">Carefully configure captions for each photo to evoke emotions <br> in your memory and bring precious moments back to life.<br>Choose opportunities for dialogue with your photos,<br> helping each of your photos find its own voice.</p>
            </div>
                <img class="carousel-img" src="{% static 'img/out2.jpeg' %}" alt="carousel-1" data-wow-delay="0.6s">
        </div>
    </div>
    <div style="background-color: red">
        <div class="Limited-time-offer">
            <H2  class="text-center" data-wow-delay="0.2s" style="font-size: 30px;color: white;">Limited time offer</H2>
            <p  class="text-center" data-wow-delay="0.4s" style="font-size: 20px;color: white;">From now on, you will be given 5 free credits when you register an account, and 3 free credits when you log in every day</p>
        </div>
    </div>
    <div class="product-card">
        <div class="card-view">
            <div class="card-item">
                <H2 style="text-align: center;margin-top: 10px;font-size: 30px">AI Intelligent Analysis</H2>
                <P style="margin: 20px;font-size: 20px">AI intelligently analyzes the content of the pictures you upload and selects the appropriate words</P>
                <img src="{% static 'img/index/image.png' %}" style="width: 90%;margin-left: 5%;margin-bottom: 5%">
            </div>
            <div class="card-item">
                <H2 style="text-align: center;margin-top: 10px;font-size: 30px">One-step generation</H2>
                <P style="margin: 20px;font-size: 20px">Simple operation, after uploading the picture, you can wait for AI analysis, display, and download the photo when you are satisfied</P>
                <img src="{% static 'img/index/image2.png' %}" style="width: 90%;margin-left: 5%;margin-bottom: 5%">
            </div>
        </div>

    </div>
    
    <div style="background-color: #1a1d20;height: 300px;">
        <div style="display:flex;width: 1440px;margin: 0 auto;">
            <img src="{% static 'img/logo-dark.png' %}" style="height: 150px;margin-left: 80px;margin-top: 80px">
            <div style="margin-top: 120px;margin-left: 200px">
               <H1 style="color: white">How to contact the author</H1>
                <p style="color: white">email: shifengwei88@126.com</p>
            </div>
        </div>
    </div>
    
{% endblock %}

<script>

        document.addEventListener("DOMContentLoaded",function (){
            
            // 检查是否存在 sessionid Cookie
            function getCookie(name){
                let cookieValue = null;
                if (document.cookie && document.cookie !=0) {
                    const cookies = document.cookie.split(';');
                    for (let i=0; i < cookies.length; i++) {
                         console.log(cookies[i])
                        const cookie = cookies[i].trim();
                        console.log(`Checking cookie: ${cookie}`);  // Debugging line
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            
            var buttonDiv = document.getElementById('buttonDiv')
            var userDiv = document.getElementById('userDiv')
            var userTitle = document.getElementById('userTitle')
            
            const sessionid = getCookie('sessionid');
            
            if (sessionid) {
                console.log('User is logged in');
                
                fetch('/api/user_info/',{
                   method:'GET',
                   headers:{
                       'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')  // 如果需要 CSRF token
                   } ,
                    credentials:'include'
                })
                    .then(response => response.json())
                    .then(data =>{
                        userTitle.textContent = data.username;
                        userDiv.style.display = 'flex';
                        buttonDiv.style.display = 'none';

                    });
                
                var sessionAge = {{ session_cookie_age|default:"3600" }};
                console.log('Session age:', sessionAge);
            
                // 假设 login_time 是从模板中传递过来的
                var loginTimeStr = "{{ request.session.login_time }}";
            
                // 解析 ISO 8601 格式的时间字符串
                var loginTime = new Date(loginTimeStr);
                console.log("Login time: ", loginTime);

                // 例如，计算登录时间与当前时间的差异
                var now = new Date();
                var timeDifference = now - loginTime;  // 时间差异以毫秒为单位

                // 检查是否超过会话过期时间
                if (timeDifference/1000 > sessionAge) {
                    userDiv.style.display = 'none';
                    buttonDiv.style.display = 'block';
                    window.location.href = "{% url 'login_out' %}";  // 假设你有一个命名为 'logout' 的 URL
                    return;
                }
            
                // 定时检查（例如每分钟检查一次）
                setInterval(function() {
                    var currentTime = Math.floor(Date.now() / 1000);
                    var elapsedTime = currentTime - loginTime;
                    if (elapsedTime/1000 > sessionAge) {
                        userDiv.style.display = 'none';
                        buttonDiv.style.display = 'block';
                        window.location.href = "{% url 'login_out' %}";
                        return;
                    }
                }, 60000); // 每60秒检查一次
            }else {
                console.log('User is not logged in');
                userDiv.style.display = 'none';
                buttonDiv.style.display = 'block';
            }
            
            
            
        });
        
        function redirectToMainView() {
            window.location.href = '{% url "mainView" %}';
        }
        
    </script>

{% block ext_js %}
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
{% endblock %}

</body>
</html>